# Goでビルドした静的ライブラリのC言語からの利用

## 概要

本サンプルは、cgoを利用してGoで実装した関数を静的ライブラリ（`.a` ファイル）としてビルドし、そのライブラリをC言語のアプリケーションに静的リンクして利用する方法を示します。

この方法により、Goで記述したロジックを、既存のC/C++アプリケーションに組み込むことが可能になります。

## ファイル構成

- `main.go`: C言語向けにエクスポートする `cgo_func` 関数をGoで実装しています。この関数は2つの整数の和を計算し、ポインタ経由で結果を返します。
- `app.c`: `main.go` で実装された `cgo_func` を呼び出すCアプリケーションです。
- `Taskfile.yml`: Goのコードを静的ライブラリとしてビルドし、Cアプリケーションとリンクして実行するまでの一連の流れを定義しています。

## 静的リンクの仕組み

1.  `go build` コマンドに `-buildmode=c-archive` オプションを付けて実行すると、GoのコードはC言語互換のヘッダファイル（`.h`）と静的ライブラリファイル（`.a`）を生成します。本サンプルでは `liba.a` という名前でライブラリを生成しています。
2.  次に、Cコンパイラ（`gcc`）でCアプリケーション（`app.c`）をコンパイルする際に、先ほど生成した静的ライブラリ `liba.a` をリンクします。
3.  静的リンクにより、Goで実装された関数のコードがCアプリケーションの実行ファイル内に直接組み込まれます。これにより、実行時に外部の共有ライブラリを必要としない、単一の実行ファイルが完成します。

## 実行方法

`Taskfile.yml` が用意されているため、`task` コマンドでビルドと実行ができます。

```bash
task
```

上記コマンドは、以下の処理を自動的に行います。

1.  Goのコードをビルドし、静的ライブラリ `liba.a` を生成します。
2.  Cのコードをコンパイルし、`liba.a` を静的リンクして `app` 実行ファイルを生成します。
3.  `nm` コマンドで、ライブラリと実行ファイルに `cgo_func` のシンボルが含まれていることを確認します。
4.  `app` を実行します。

## 実行結果

```
65535
```

この結果は、`app.c` で渡された `0x00FF` (255) と `0xFF00` (65280) を、Goで実装された `cgo_func` が足し合わせた結果 (`255 + 65280 = 65535`) です。
